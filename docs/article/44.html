<!DOCTYPE html>
<html amp lang="zh-CN">

<head>
<meta charset="UTF-8">
<script async src="https://cdn.ampproject.org/v0.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>半小时学会V语言 – V语言中文社区</title>
<link rel="dns-prefetch" href="https://vlanguage.cn">
<link rel="dns-prefetch" href="//s.w.org">



<link rel="stylesheet" id="tortuga-custom-fonts-css" href="https://vlanguage.cn/wp-content/themes/tortuga/assets/css/custom-fonts.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-block-library-css" href="https://vlanguage.cn/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all">
<link rel="stylesheet" id="tortuga-stylesheet-css" href="https://vlanguage.cn/wp-content/themes/tortuga/style.css" type="text/css" media="all">
<style id="tortuga-stylesheet-inline-css" type="text/css">
.site-description { position: absolute; clip: rect(1px, 1px, 1px, 1px); width: 1px; height: 1px; overflow: hidden; }
</style>
<link rel="stylesheet" id="genericons-css" href="https://vlanguage.cn/wp-content/themes/tortuga/assets/genericons/genericons.css" type="text/css" media="all">
<link rel="stylesheet" id="themezee-related-posts-css" href="https://vlanguage.cn/wp-content/themes/tortuga/assets/css/themezee-related-posts.css" type="text/css" media="all">

<script type="text/javascript" src="https://vlanguage.cn/wp-includes/js/jquery/jquery.js"></script>
<script type="text/javascript" src="https://vlanguage.cn/wp-includes/js/jquery/jquery-migrate.min.js"></script>
<script type="text/javascript" src="https://vlanguage.cn/wp-content/themes/tortuga/assets/js/navigation.js"></script>









		<style type="text/css" id="wp-custom-css">
			.header-main {
	display: none;
}		</style>
			
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?623969e39431ed8038c14723604877f6";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
	<script data-ad-client="ca-pub-8889449066804352" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script>
	<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
	</head>

<body class="post-template-default single single-post postid-44 single-format-standard wp-embed-responsive">

	<div id="page" class="hfeed site">

		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		
		<header id="masthead" class="site-header clearfix" role="banner">

			<div class="header-main container clearfix">

				<div id="logo" class="site-branding clearfix">

										
			<p class="site-title"><a href="https://vlanguage.cn/" rel="home">V语言中文社区</a></p>

							
				</div>

				<div class="header-widgets clearfix">

					
				</div>

			</div>

			<div id="main-navigation-wrap" class="primary-navigation-wrap">

				<nav id="main-navigation" class="primary-navigation navigation container clearfix" role="navigation">

					
					<ul id="menu-daohang" class="main-navigation-menu"><li id="menu-item-9" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-9"><a href="/">V语言中文社区</a></li>
<li id="menu-item-121" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-121"><a target="_blank" rel="noopener noreferrer" href="/index2.html">历史文章</a></li>
<li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a target="_blank" rel="noopener noreferrer" href="/docs/">Docs文档</a></li>
</ul>				</nav>

			</div>

		</header>

		
		
		<div id="content" class="site-content container clearfix">

	<section id="primary" class="content-single content-area">
		<main id="main" class="site-main" role="main">
				
		<div id="magazine-homepage-widgets" class="widget-area clearfix">

			<div id="custom_html-3" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8889449066804352" data-ad-slot="6054387901" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></div>
		</div>

<article id="post-44" class="post-44 post type-post status-publish format-standard hentry">

	
	<header class="entry-header">

		<h1 class="entry-title">半小时学会V语言</h1>
		<div class="entry-meta"><span class="meta-date"><a href="https://vlanguage.cn/article/44.html" title="上午9:35" rel="bookmark"><time class="entry-date published updated" datetime="2019-07-08T09:35:00+08:00">2019/7/8</time></a></span><span class="meta-category"> 未分类</span></div>
	</header>

	<div class="entry-content clearfix">

		<div id="article_content" class="article_content clearfix">
<div class="article-source-link">
   原文链接：<br>
  <a href="http://www.cnblogs.com/vlangdev/p/11149328.html" target="_blank" rel="noopener noreferrer">http://www.cnblogs.com/vlangdev/p/11149328.html</a>
 </div>
<p> <br>
 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-d284373521.css">
</p><div class="htmledit_views" id="content_views">
<div id="cnblogs_post_body" class="blogpost-body">
<p><span style="font-size:18pt;"><strong>半小时学会V语言</strong></span></p>
<p>1. V语言简介<br> V是一个静态类型、编译型的编程语言，目标是构建可维护软件。与Go语言相似，并受Oberon，Rust和Swift语言影响。<br>V语言非常简单，只需要半小时就能学会这门语言的绝大多数核心内容。<br>尽管语法极致简单，但V语言给予了开发者无尽的能力。能通过其他语言中实现的程序，都可以通过V语言来做到。</p>
<p>2. Hello World<br>展示一下V语言的Hello world 代码：<br>fn main() {<br> println(‘hello world’)<br>}</p>
<p>函数通过关键字 fn 来声明。函数返回类型，写在函数名后面。这里，main() 没有返回类型，因此被省略。<br>与C语言相同，main是程序的入口点。<br>V语言的内置函数很少，println 是其中之一，它向标准输出进行打印输出。<br>如果一个程序的代码，只由一个文件构成，那么main() 也可以省略。这样，编写一些小程序，script脚本，会非常方便。<br>本文后续的例子，都会省略main()。因此，hello world 程序，可以精简为只有一句：<br>println(‘hello world’)</p>
<p>3. 注释<br>// 这是单行注释</p>
<p>/* 这是多行注释<br> /* 并且多行注释可以嵌套 */<br>*/</p>
<p>4. 函数<br>fn main() {<br> println(add(77, 33))<br> println(sub(100, 50))<br>}</p>
<p>fn add(x int, y int) int {<br> return x + y<br>}</p>
<p>fn sub(x, y int) int {<br> return x – y<br>}<br>参数的类型，写在参数名的后面。<br>与Go和C相同，函数不能被重载(overload)。这简化了代码，提高了可维护性、可读性。<br>函数可以在声明前被使用。上例中，add 和 sub 的声明在main后面，但可以在main() 中被调用。V语言中所有的声明，都遵循此原则，这样就消除了头文件，也无需考虑文件和声明的顺序关系。</p>
<p>5. 变量<br>name := ‘Bob’ <br>age := 20<br>large_number := i64(9999999999)<br>println(name)<br>println(age)<br>println(large_number) <br>变量用 := 进行声明和初始化。这是V中唯一的变量声明方式，这意味着变量总是有一个初始值。<br>变量的类型，是从右边的值推断出来的。如果要指定类型，使用类型转换语法： T(v) 会把值v转换成类型T.<br>与大多数语言不同的是，V语言仅允许在函数中声明变量。全局变量是不允许的,V语言中没有全集状态。</p>
<p>mut age := 20<br>println(age)<br>age = 21<br>println(age)<br>用 = 修改变量的值。V语言中，变量缺省是不可修改的(immutable)。如果变量的值需要被修改，那么变量必须用 mut来声明。<br>注意这两个操作符的区别：<br>:= 用于变量声明和初始化，而 = 用于赋值。</p>
<p>fn main() {<br> age = 21<br>}<br>这个代码无法通过编译，因为变量age 没有被声明。 V语言中所有的变量都必须声明后才能被使用。</p>
<p>fn main() {<br> age := 21<br>}<br>这个代码也无法通过编译，因为未被使用的变量会导致编译报错。</p>
<p>fn main() {<br> a := 10 <br> if true {<br> a := 20<br> } <br>}<br>变量遮蔽(variable shadow) 是不允许的。声明一个与父作用域中同名的变量，会导致编译报错。</p>
<p>6. 基本数据类型<br>bool<br>string<br>i8 i16 i32 i64 i128 (soon)<br>u8 u16 u32 u64 u128 (soon) </p>
<p>byte // alias for u8 <br>int // alias for i32 <br>rune // alias for i32, represents a Unicode code point </p>
<p>f32 f64</p>
<p>byteptr<br>voidptr</p>
<p>注意： int 永远是32位整数。</p>
<p>7. Strings<br>name := ‘Bob’ <br>println(‘Hello, $name!’) // `$` 用于将变量格式化为字符串 <br>println(name.len) </p>
<p>bobby := name + ‘by’ // + 用于拼接字符串<br>println(bobby) // ==> “Bobby” </p>
<p>println(bobby.substr(1, 3)) // ==> “ob” <br>// println(bobby[1:3]) // 这个语法，与substr()相同</p>
<p>V语言中，string 是只读的字节数组，总是采用UTF-8 编码。<br>单引号和双引号都可以用于表示字符串(现在双引号还未实现)。出于一致性，vfmt 会把双引号换成单引号，除非字符串中有单引号。<br>string 也是不可修改的，因此substring 非常高效：不需要内存copy，不需要额外的内存分配。</p>
<p>V语言中，所有的操作符，两边的操作数必须类型完全一致。下面的代码，如果age是个int，则无法通过编译：<br>println(‘age = ‘ + age)<br>把age转换成string才可以：<br>println(‘age = ‘ + age.str())<br>或者，使用字符串格式化方法(推荐):<br>println(‘age = $age’)</p>
<p>8. 数组 Arrays<br>nums := [1, 2, 3]<br>println(nums)<br>println(nums[1]) // ==> “2” </p>
<p>mut names := [‘John’]<br>names << ‘Peter’ <br>names << ‘Sam’ <br>// names << 10 <– 无法编译. `names` 是一个字符串数组. <br>println(names.len) // ==> “3” <br>println(‘Alex’ in names) // ==> “false” </p>
<p>// 可以预先分配数组的容量 <br>nr_ids := 50<br>mut ids := [0 ; nr_ids] // 创建一个50个元素的数值，每个元素的值都是0 </p>
<p>数组的类型由第一个元素的类型决定： [1, 2, 3]的类型是整数数组([]int), [‘a’, ‘b’] 的类型为字符串数组([]string)<br>数组中的各个元素，类型必须完全一致。[1, ‘a’] 无法通过编译。<br><< 操作符，将一个值添加到数组的末尾。<br>.len 成员返回数组的长度. 注意，这是个只读属性，不能被修改。V语言中所有导出的域(export field)，缺省都是只读的。<br>val in array 当array中包含val 时返回true，否则返回false。</p>
<p>9. Maps<br>mut m := map[string]int{} // 当前，map的key仅支持string<br>m[‘one’] = 1<br>println(m[‘one’]) // ==> “1” <br>println(m[‘bad_key’]) // ==> “0” <br>// TODO: implement a way to check if the key exists </p>
<p>numbers := { // TODO: this syntax is not implemented yet <br> ‘one’: 1,<br> ‘two’: 2,<br>} </p>
<p>10. If<br>a := 10 <br>b := 20 <br>if a < b { <br> println(‘$a < $b’) <br>} else if a > b { <br> println(‘$a > $b’) <br>} else { <br> println(‘$a == $b’) <br>} <br>if 语句，与其它语法非常类似。与C语言不同的是，V语言if 后面的条件，是没有括号包围的。</p>
<p>if 也可以作为表达式：<br>num := 777<br>s := if num % 2 == 0 {<br> ‘even’<br>}<br>else {<br> ‘odd’<br>}<br>println(s) // ==> “odd”</p>
<p>11. in 操作符<br>in 用于检查数组中是否包含某个元素。<br>nums := [1, 2, 3]<br>println(1 in nums) // ==> true</p>
<p>in 也用于编写更加干净简洁的boolean表达式。比如下面这个例子：<br>if parser.token == .plus || parser.token == .minus || parser.token == .div || parser.token == .mult {<br> … <br>} <br>用 in 改写为：<br>if parser.token in [.plus, .minus, .div, .mult] {<br> … <br>}<br>V编译器对这样的表达式进行优化，因此上面的in和if都产生同样的机器码，没有array 被创建。</p>
<p>12. For循环<br>V只有for 一种循环结构：<br>numbers := [1, 2, 3, 4, 5]<br>for num in numbers {<br> println(num)<br>}</p>
<p>names := [‘Sam’, ‘Peter’]<br>for i, name in names {<br> println(‘$i) $name’) // Output: 0) Sam<br>} // 1) Peter</p>
<p>for value in array 用于遍历一个数组中的所有元素。如果需要用下标，可以用 for index, value in array 形式。<br>注意，value是只读的。如果要在循环过程中修改数组的元素值，那么必须用下标：<br>mut numbers := [1, 2, 3, 4, 5]<br>for i, num in numbers {<br> println(num)<br> numbers[i] = 0<br>}</p>
<p>mut sum := 0<br>mut i := 0<br>for i <= 100 {<br> sum += i<br> i++<br>}<br>println(sum) // ==> “5050”<br>这种形式的循环，类似其它语言中的while 循环，当条件变为false时，循环结束。</p>
<p>再次强调： 判断条件没有() 包围，但 {} 是必需的。</p>
<p>mut num := 0<br>for {<br> num++<br> if num >= 10 {<br> break <br> } <br>}<br>println(num) // ==> “10” <br>条件可以被省略，实现一个无限循环。</p>
<p> </p>
<p>for i := 0; i < 10; i++ {<br> println(i)<br>}<br>最后，这种C 风格的循环也支持，它比while形式的循环要安全，因为while循环中容易忘记更新计数器，从而产生无限循环。<br>这里， i 不需要用 mut 声明，因为这种场合它永远都是要被修改的。</p>
<p>13. switch<br>os := ‘windows’ <br>print(‘V is running on ‘)<br>switch os {<br>case ‘darwin’:<br> println(‘macOS.’)<br>case ‘linux’:<br> println(‘Linux.’)<br>default:<br> println(os) <br>}<br>// TODO: replace with match expressions<br>switch 语句简化了一系列 if – else 的语句。它按顺序进行匹配，匹配成功后，执行对应的分支代码。<br>与C不同，每个case 块不需要break语句。</p>
<p>14. struct<br>struct Point {<br> x int<br> y int <br>} </p>
<p>p := Point{<br> x: 10 <br> y: 20 <br>} <br>println(p.x) // Struct fields are accessed using a dot </p>
<p>struct在栈上分配内存。如果要在堆上分配struct，并获得指向它的指针，可以使用 & 前缀：<br>pointer := &Point{10, 10} // Alternative initialization syntax for structs with 3 fields or fewer<br>println(pointer.x) // Pointers have the same syntax for accessing fields </p>
<p>V语言不支持继承，也没有子类，但支持嵌套结构：<br>// TODO: this will be implemented later in June<br>struct Button {<br> Widget<br> title string<br>}</p>
<p>button := new_button(‘Click me’)<br>button.set_pos(x, y)</p>
<p>// Without embedding we’d have to do<br>button.widget.set_pos(x,y)</p>
<p>15. 成员访问修饰符(Access modifiers)<br>struct 的成员，缺省是私有的(private),并且不可修改(immutable)。 可以用 pub 和 mut 来修饰，总计有5种可能的组合：<br>struct Foo {<br> a int // private immutable (default) <br>mut: <br> b int // private mutable <br> c int // (you can list multiple fields with the same access modifier) <br>pub: <br> d int // public immmutable (readonly) <br>pub mut: <br> e int // public, but mutable only in parent module <br>pub mut mut: <br> f int // public and mutable both inside and outside parent module <br>} // (not recommended to use, that’s why it’s so verbose) </p>
<p>例如，builtin 模块中string的类型定义：<br>struct string {<br> str byteptr<br>pub:<br> len int<br>}<br>从这个定义，可以清晰看出，string是个不可修改的类型(immutable type)<br>string的byte指针，无法在bultin模块之外被访问。 len 是public，但不能被修改。</p>
<p>fn main() {<br> str := ‘hello’ <br> len := str.len // OK <br> str.len++ // Compilation error <br>} </p>
<p>16. Methods<br>struct User {<br> age int <br>} </p>
<p>fn (u User) can_register() bool {<br> return u.age > 16 <br>} </p>
<p>user := User{age: 10} <br>println(user.can_register()) // ==> “false” </p>
<p>user2 := User{age: 20} <br>println(user2.can_register()) // ==> “true” </p>
<p>V 语言并不支持 class。但是你可以在类型上定义方法(method).<br>方法(method) 也是函数，只是带特殊的接收者。接收者在fn 和方法名之间。<br>上例中，can_register 方法有一个接收者，类型为User，参数名为u. 依照惯例，接收者不使用self或this 这样的名字，推荐使用一个字母的名字。</p>
<p>17. Pure functions by default<br>V语言的函数，缺省是纯函数，意味着函数返回值只由参数决定，计算过程没有副作用。这是由于，没有全局变量，所有的参数缺省都是不可修改的，即使是传引用。<br>然而，V语言不是纯粹的函数语言，可以通过关键字mut 来修改函数参数：<br>struct User {<br>mut:<br> is_registered bool <br>} </p>
<p>fn (u mut User) register() {<br> u.is_registered = true <br>} </p>
<p>mut user := User{} <br>println(user.is_registered) // ==> “false” <br>user.register() <br>println(user.is_registered) // ==> “true” <br>上例中，接收者被标记为可修改，因此register() 可以修改user 对象。 对其它参数，也是这样的语法：</p>
<p>fn multiply_by_2(arr mut []int) {<br> for i := 0; i < arr.len; i++ {<br> arr[i] *= 2<br> }<br>}</p>
<p>mut nums := [1, 2, 3]<br>multiply_by_2(mut nums)<br>println(nums) // ==> “[2, 4, 6]”</p>
<p>注意：调用multiply_by_2 函数时，必须在nums 前面增加 mut。这清晰地表达了，这个调用会修改这个值。</p>
<p>如果能够通过返回值来实现，就不要通过修改参数参数来实现。修改参数，应该仅用于对性能有严格要求的场景，减少对象的分配和复制。<br>推荐采用 user.register() 或 user = register(user) ， 而不用 register(mut user)。</p>
<p>V语言中，非常容易返回一个对象的修改后副本：<br>fn register(u User) User { <br> return { u | is_registered: true } <br>}</p>
<p>user = register(user) </p>
<p>18. 常量 Constants<br>const (<br> PI = 3.14<br> World = ‘世界’<br>) </p>
<p>println(PI)<br>println(World)<br>常量用 const 声明，并且仅能在 模块级定义（函数外）。<br>常量首字母必须大写，这样能与变量区分开来。<br>常量值无法改变。</p>
<p>V语言中的常量，比其它语言要灵活得多。可以赋与更复杂的值：<br>struct Color {<br> r int<br> g int<br> b int<br>}</p>
<p>fn (c Color) str() string { return ‘{$c.r, $c.g, $c.b}’ }</p>
<p>fn rgb(r, g, b int) Color { return Color{r: r, g: g, b: b} }</p>
<p>const (<br> Numbers = [1, 2, 3]</p>
<p> Red = Color{r: 255, g: 0, b: 0}<br> Blue = rgb(0, 0, 255)<br>)</p>
<p>println(Numbers)<br>println(Red)<br>println(Blue)</p>
<p>由于不支持全局变量，因此这个特性非常有用。</p>
<p>19. 模块 Modules<br>V语言是个模块化语言。 鼓励创建可重用模块，创建的过程也非常简单。创建一个新的模块，你只需要创建一个目录(模块名),目录下放入一个 模块名.v 的源码文件：<br>cd ~/code/modules<br>mkdir mymodule<br>vim mymodule/mymodule.v</p>
<p>// mymodule.v<br>module mymodule</p>
<p>// To export a function we have to use `pub`<br>pub fn say_hi() {<br> println(‘hello from mymodule!’)<br>}</p>
<p>在 mymodule/ 目录下，你可以有很多.v 文件。<br>用 v -lib ~/code/modules/mymodule 来编译这个模块(会被自动放到 vlib路径中)。</p>
<p>在其它工程中，使用这个模块：<br>module main</p>
<p>import mymodule</p>
<p>fn main() {<br> mymodule.say_hi()<br>}</p>
<p>注意，每次调用外部函数时，都必须指定模块名。这看起来非常麻烦，但使代码更易读，容易理解，清晰表达了哪个模块哪个函数被调用，尤其在大工程中。<br>模块名应该简短，不超过10个字符。 循环 import 是不允许的。<br>你可以在任何位置，创建模块。<br>所有的模块，都被静态链接，最终形成一个单一的可执行文件。</p>
<p>20. Interfaces<br>struct Dog {}<br>struct Cat {}</p>
<p>fn (d Dog) speak() string { <br> return ‘woof’<br>} </p>
<p>fn (c Cat) speak() string { <br> return ‘meow’ <br>} </p>
<p>interface Speaker {<br> speak() string<br>}</p>
<p>fn perform(s Speaker) { <br> println(s.speak())<br>} </p>
<p>dog := Dog{} <br>cat := Cat{} <br>perform(dog) // ==> “woof” <br>perform(cat) // ==> “meow” </p>
<p>一个类型，实现了接口的方法，就表示实现了接口。没有显式的声明，也没有implements 关键字。</p>
<p>21. Enums<br>enum Color {<br> red green blue <br>} </p>
<p>mut color := Color.red<br>// V knows that `color` is a `Color`. No need to use `Color.green` here.<br>color = .green <br>println(color) // ==> “1” TODO: print “green”? </p>
<p>22. Option/Result types & error handling<br>struct User {<br> id int <br> name string<br>} </p>
<p>struct Repo {<br> users []User <br>} </p>
<p>fn new_repo() Repo {<br> return Repo {<br> users: [User{1, ‘Andrew’}, User {2, ‘Bob’}, User {10, ‘Charles’}]<br> }<br>} </p>
<p>fn (r Repo) find_user_by_id(id int) ?User { <br> for user in r.users {<br> if user.id == id {<br> // V automatically wraps this into an option type <br> return user <br> } <br> } <br> return error(‘User $id not found’) <br>} </p>
<p>fn main() {<br> repo := new_repo() <br> user := repo.find_user_by_id(10) or { // Option types must be handled by `or` blocks <br> return // `or` block must end with `return`, `break`, or `continue` <br> } <br> println(user.id) // ==> “10” <br> println(user.name) // ==> ‘Charles’<br>}</p>
<p>V 把Option和Result 合并成一个类型。<br>产生的额外工作是：函数的返回类型前面增加?, 函数体中出现错误时返回一个error。<br>如果你不需要返回error， 可以简单返回 None。 (TODO: None is not implemented yet).<br>这是V语言中处理错误的主要方式。优点是 error 必须被处理，并且处理起来也非常简洁。<br>也可以继续传播 error：</p>
<p>resp := http.get(url)?<br>println(resp.body)</p>
<p>http.get 返回 ?http.Response. 调用时带 ?, 会使error 继续向上传播给父调用者。 这里，传播到main() ，会引发 panic。 <br>因此上面的代码，是下面代码的简化：<br>resp := http.get(url) or {<br> panic(err)<br>}<br>println(resp.body)</p>
<p>23. 范型Generics (七月份实现)<br>struct Repo⟨T⟩ {<br> db DB<br>}</p>
<p>fn new_repo⟨T⟩(db DB) Repo⟨T⟩ {<br> return Repo⟨T⟩{db: db}<br>}</p>
<p>// This is a generic function. V will generate it for every type it’s used with. <br>fn (r Repo⟨T⟩) find_by_id(id int) ?T { <br> table_name := T.name // in this example getting the name of the type gives us the table name <br> return r.db.query_one⟨T⟩(‘select * from $table_name where id = ?’, id)<br>}</p>
<p>db := new_db()<br>users_repo := new_repo⟨User⟩(db)<br>posts_repo := new_repo⟨Post⟩(db)<br>user := users_repo.find_by_id(1)? <br>post := posts_repo.find_by_id(1)?</p>
<p>为了可读性, 范型推荐使用⟨⟩ , 而不是<>. vfmt 自动会把 <> 替换为 ⟨⟩.</p>
<p>24. Concurrency<br>V语言的并发模型，与Go语言非常类似。为了并发运行 foo() ，只需要用 go foo() 调用它即可。 当前，用一个新的系统线程来执行这个函数。 后续, goroutines 和 scheduler会实现。</p>
<p>25. Decoding JSON<br>struct User {<br> name string<br> age int <br> foo Foo [skip] // Use `skip` attribute to skip certain fields <br>} </p>
<p>data := ‘{ “name”: “Frodo”, “age”: 25 }’<br>user := json.decode(User, data) or {<br> eprintln(‘Failed to decode json’)<br> return <br>} <br>println(user.name)<br>println(user.age) </p>
<p>JSON现在非常流行，因此V语言内置支持了JSON。<br>json.decode 函数的第一个参数是解码的目标类型，第二个参数是JSON字符串。<br>V自动生成JSON编码和解码的代码。不使用运行时反射，因此性能更好。</p>
<p> </p>
<p>26. 测试 Testing<br>// hello.v <br>fn hello() string {<br> return ‘Hello world’<br>} </p>
<p>// hello_test.v <br>fn test_hello() {<br> assert hello() == ‘Hello world’<br>} </p>
<p>所有的测试函数，都需要放入 *_test.v 文件中，并且测试函数名必须以 test_ 开头。 <br>运行一个测试文件： <br>v hello_test.v<br>运行整个模块的所有测试文件：<br>v test mymodule</p>
<p> </p>
<p>27. 内存管理 Memory management<br>没有垃圾回收(garbage collection), 也没有引用计数。 V 清理它能在编译期确定的一切。例如：</p>
<p>fn draw_text(s string, x, y int) {<br> …<br>}</p>
<p>fn draw_scene() {<br> … <br> draw_text(‘hello $name1’, 10, 10)<br> draw_text(‘hello $name2’, 100, 10)<br> draw_text(strings.repeat(‘X’, 10000), 10, 50)<br> … <br>}</p>
<p>字符串与draw_text 函数紧密关联，因此函数执行完毕后字符串即被清理。<br>实际上，前2个调用根本没有参数任何内存分配。这两个字符串比较小，因此V用一个预分配的buffer来放他们。<br>对于更复杂的例子，需要手工管理内存。后续会很快修复。</p>
<p>V 会在运行时检测内存泄漏，并且汇报它们。 要清除内存，需要调用free() 方法：</p>
<p>numbers := [0; 1000000] <br>…<br>numbers.free()</p>
<p>28. Defer<br>TODO</p>
<p>29. vfmt<br>TODO</p>
<p>30. Advanced Topics<br>30.1 Calling C functions from V<br>#flag -lsqlite3</p>
<p>#include “sqlite3.h”</p>
<p>struct C.sqlite3 <br>struct C.sqlite3_stmt </p>
<p>fn C.sqlite3_column_int(C.sqlite_stmt, int) int </p>
<p>fn main() {<br> path := ‘sqlite3_users.db’ <br> db := &C.sqlite3{} <br> C.sqlite3_open(path.cstr(), &db)</p>
<p> query := ‘select count(*) from users’ <br> stmt := &C.sqlite3_stmt{} <br> C.sqlite3_prepare_v2(db, query.cstr(), – 1, &stmt, 0)<br> C.sqlite3_step(stmt) <br> nr_users := C.sqlite3_column_int(res, 0)<br> C.sqlite3_finalize(res)<br> println(nr_users) <br>}</p>
<p>C 字符串，可以通过 string(cstring) 转换成 V的string。</p>
<p>30.2 Compile time if<br>$if windows {<br> println(‘Windows’) <br>} <br>$if linux {<br> println(‘Linux’) <br>} <br>$if mac {<br> println(‘macOS’) <br>} <br>Compile time if 用 $if 开头. 当前，仅能用于检测OS.</p>
<p>30.3 Reflection via codegen<br>内置了JSON支持，非常好的特性。但V语言允许你对任何对象创建高效的序列化器：<br>// TODO: planned in June<br>fn decode<T>(data string) T {<br> mut result := T{}<br> for field in T.fields {<br> if field.typ == ‘string’ {<br> result.$field = get_string(data, field.name)<br> } else if field.typ == ‘int’ {<br> result.$field = get_int(data, field.name)<br> }<br> }<br> return result<br>}</p>
<p>// generates to:<br>fn decode_User(data string) User {<br> mut result := User{}<br> result.name = get_string(data, ‘name’)<br> result.age = get_int(data, ‘age’)<br> return result<br>}</p>
<p>30.4 Limited operator overloading<br>struct Vec {<br> x int<br> y int<br>}</p>
<p>fn (a Vec) str() string { <br> return ‘{$a.x, $a.y}’ <br>}</p>
<p>fn (a Vec) + (b Vec) Vec {<br> return Vec {<br> a.x + b.x, <br> a.y + b.y <br> }<br>}</p>
<p>fn (a Vec) – (b Vec) Vec {<br> return Vec {<br> a.x – b.x, <br> a.y – b.y<br> }<br>}</p>
<p>fn main() { <br> a := Vec{2, 3}<br> b := Vec{4, 5}<br> println(a + b) // ==> “{6, 8}” <br> println(a – b) // ==> “{-2, -2}” <br>}</p>
<p>操作符重载，与V的简单、可预期性相矛盾。但科学计算、GUI程序都是V的主打领域，因此操作符重载是提高代码可读性的重要手段：<br>a.add(b).add(c.mul(d)) 不如 a + b + c * d 清晰易读</p>
<p>为了提供安全性和可维护性，操作符重载有一些限制：<br>– 仅能重载 +, -, *, / 操作符<br>– 操作符函数中不能调用其它函数 <br>– 操作符函数不能修改它们的参数<br>– 两个参数必须类型完全一致</p>
<p> </p>
<p>更多V语言的介绍，可以关注微信号 vlangdev  或扫描二维码  <img src="https://img2018.cnblogs.com/blog/1732744/201907/1732744-20190705083124019-2075308990.jpg" alt="" width="102" height="102"></p>
</div>
<p>转载于:https://www.cnblogs.com/vlangdev/p/11149328.html</p>
</div>
</div>

		
	</div>

	<footer class="entry-footer">

						
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">文章导航</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://vlanguage.cn/article/95.html" rel="prev"><span class="screen-reader-text">Previous Post:</span>FPGA笔记之verilog语言（基础语法篇）</a></div><div class="nav-next"><a href="https://vlanguage.cn/article/33.html" rel="next"><span class="screen-reader-text">Next Post:</span>持续排名GITHUB榜首的V语言竟是C++的孪生兄弟-V版毁灭战士值得点赞</a></div></div>
	</nav>
	</footer>

</article>
			
			<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">	</script>
			<ins class="adsbygoogle" style="display:block" data-ad-format="autorelaxed" data-ad-client="ca-pub-8889449066804352" data-ad-slot="1928667997"></ins>
			<script>
				 (adsbygoogle = window.adsbygoogle || []).push({});
			</script>
		
		</main>
	</section>
	
	
	<section id="secondary" class="sidebar widget-area clearfix" role="complementary">

		<div class="widget_text widget-wrap"><aside id="custom_html-3" class="widget_text widget widget_custom_html clearfix"><div class="textwidget custom-html-widget"><script async src="https://cse.google.com/cse.js?cx=004431708863642777669:dt5gmztovfo"></script>
<div class="gcse-search"></div>
<style>
td.gsc-search-button {
    width: 90px;
}
.gsc-control-cse table{
	margin: 0;
}
.gsc-control-cse th, td {
	border: none;
}
	
	td.gsib_b {
		
    width: 36px;

	}
	.gscb_a {
		width: 94%;
    line-height: 20px;
		font-size: 20px;
}
	.gsst_b {
		font-size: 12px;
	}
	#custom_html-5 {
		padding: 0;
	}
	.cse .gsc-control-cse, .gsc-control-cse {
    border: none;
}
	.cse .gsc-control-cse, .gsc-control-cse {
    padding: 4px 4px 0px 4px;
}
</style></div></aside></div>		<div class="widget-wrap"><aside id="recent-posts-2" class="widget widget_recent_entries clearfix">		<div class="widget-header"><h3 class="widget-title">近期文章</h3></div>		<ul>
											<li>
					<a href="https://vlanguage.cn/article/35.html">【GitHub探索】v语言上手，用vlang写一个聊天应用</a>
									</li>
											<li>
					<a href="https://vlanguage.cn/article/97.html">v-if/v-if-else/v-show</a>
									</li>
											<li>
					<a href="https://vlanguage.cn/article/75.html">又一编程语言开源上线了</a>
									</li>
											<li>
					<a href="https://vlanguage.cn/article/81.html">V-REP 机器人语言解释器集成教程</a>
									</li>
											<li>
					<a href="https://vlanguage.cn/article/68.html">三小时学会V语言到放弃（第二小时）</a>
									</li>
					</ul>
		</aside></div><div class="widget_text widget-wrap"><aside id="custom_html-5" class="widget_text widget widget_custom_html clearfix"><div class="textwidget custom-html-widget"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8889449066804352" data-ad-slot="6054387901" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></aside></div><div class="widget-wrap"><aside id="tag_cloud-3" class="widget widget_tag_cloud clearfix"><div class="widget-header"><h3 class="widget-title">标签</h3></div><div class="tagcloud"><a href="https://vlanguage.cn/tag/blog" class="tag-cloud-link tag-link-35 tag-link-position-1" style="font-size: 8pt;" aria-label="blog (1个项目)">blog<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/c" class="tag-cloud-link tag-link-39 tag-link-position-2" style="font-size: 8pt;" aria-label="c (1个项目)">c<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/dyuyan" class="tag-cloud-link tag-link-45 tag-link-position-3" style="font-size: 8pt;" aria-label="d语言 (1个项目)">d语言<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/eclipse" class="tag-cloud-link tag-link-30 tag-link-position-4" style="font-size: 8pt;" aria-label="eclipse (1个项目)">eclipse<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/google" class="tag-cloud-link tag-link-51 tag-link-position-5" style="font-size: 8pt;" aria-label="google (1个项目)">google<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/java" class="tag-cloud-link tag-link-33 tag-link-position-6" style="font-size: 8pt;" aria-label="java (1个项目)">java<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/shingekinov" class="tag-cloud-link tag-link-14 tag-link-position-7" style="font-size: 8pt;" aria-label="shingekinov (1个项目)">shingekinov<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/spir-v" class="tag-cloud-link tag-link-24 tag-link-position-8" style="font-size: 8pt;" aria-label="SPIR-V (1个项目)">SPIR-V<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/vyuyan" class="tag-cloud-link tag-link-10 tag-link-position-9" style="font-size: 8pt;" aria-label="v语言 (1个项目)">v语言<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/houduan" class="tag-cloud-link tag-link-13 tag-link-position-10" style="font-size: 8pt;" aria-label="后端 (1个项目)">后端<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/gongju" class="tag-cloud-link tag-link-32 tag-link-position-11" style="font-size: 8pt;" aria-label="工具 (1个项目)">工具<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/pingtai" class="tag-cloud-link tag-link-38 tag-link-position-12" style="font-size: 14.3pt;" aria-label="平台 (2个项目)">平台<span class="tag-link-count"> (2)</span></a>
<a href="https://vlanguage.cn/tag/minjie" class="tag-cloud-link tag-link-41 tag-link-position-13" style="font-size: 8pt;" aria-label="敏捷 (1个项目)">敏捷<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/wendang" class="tag-cloud-link tag-link-42 tag-link-position-14" style="font-size: 14.3pt;" aria-label="文档 (2个项目)">文档<span class="tag-link-count"> (2)</span></a>
<a href="https://vlanguage.cn/tag/fuwuduan" class="tag-cloud-link tag-link-12 tag-link-position-15" style="font-size: 8pt;" aria-label="服务端 (1个项目)">服务端<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/kuangjia" class="tag-cloud-link tag-link-40 tag-link-position-16" style="font-size: 8pt;" aria-label="框架 (1个项目)">框架<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/biancheng" class="tag-cloud-link tag-link-36 tag-link-position-17" style="font-size: 8pt;" aria-label="编程 (1个项目)">编程<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/wangluo" class="tag-cloud-link tag-link-37 tag-link-position-18" style="font-size: 8pt;" aria-label="网络 (1个项目)">网络<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/liaotianfuwuqi" class="tag-cloud-link tag-link-11 tag-link-position-19" style="font-size: 8pt;" aria-label="聊天服务器 (1个项目)">聊天服务器<span class="tag-link-count"> (1)</span></a>
<a href="https://vlanguage.cn/tag/yuyan" class="tag-cloud-link tag-link-31 tag-link-position-20" style="font-size: 22pt;" aria-label="语言 (4个项目)">语言<span class="tag-link-count"> (4)</span></a></div>
</aside></div><div class="widget_text widget-wrap"><aside id="custom_html-6" class="widget_text widget widget_custom_html clearfix"><div class="textwidget custom-html-widget"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8889449066804352" data-ad-slot="6054387901" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></aside></div><div class="widget-wrap"><aside id="categories-2" class="widget widget_categories clearfix"><div class="widget-header"><h3 class="widget-title">分类目录</h3></div>		<ul>
				<li class="cat-item cat-item-53"><a href="https://vlanguage.cn/category/c-c-c">C/C++/C#</a> (3)
</li>
	<li class="cat-item cat-item-44"><a href="https://vlanguage.cn/category/dyuyankaifa">D语言开发</a> (1)
</li>
	<li class="cat-item cat-item-49"><a href="https://vlanguage.cn/category/fpga">FPGA</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="https://vlanguage.cn/category/githubtansuo">GitHub探索</a> (1)
</li>
	<li class="cat-item cat-item-54"><a href="https://vlanguage.cn/category/googlemap">GoogleMap</a> (1)
</li>
	<li class="cat-item cat-item-6"><a href="https://vlanguage.cn/category/gozixuezhilu">GO自学之路</a> (2)
</li>
	<li class="cat-item cat-item-21"><a href="https://vlanguage.cn/category/graphics">Graphics</a> (1)
</li>
	<li class="cat-item cat-item-28"><a href="https://vlanguage.cn/category/linux">Linux</a> (1)
</li>
	<li class="cat-item cat-item-43"><a href="https://vlanguage.cn/category/nodejs">Nodejs</a> (1)
</li>
	<li class="cat-item cat-item-25"><a href="https://vlanguage.cn/category/phpcms">phpcms</a> (2)
</li>
	<li class="cat-item cat-item-19"><a href="https://vlanguage.cn/category/phpcmsjiaocheng">phpcms教程</a> (1)
</li>
	<li class="cat-item cat-item-34"><a href="https://vlanguage.cn/category/risc-v">RISC-V</a> (1)
</li>
	<li class="cat-item cat-item-23"><a href="https://vlanguage.cn/category/spir">SPIR</a> (1)
</li>
	<li class="cat-item cat-item-52"><a href="https://vlanguage.cn/category/vue">Vue</a> (1)
</li>
	<li class="cat-item cat-item-22"><a href="https://vlanguage.cn/category/vulkan">Vulkan</a> (1)
</li>
	<li class="cat-item cat-item-7"><a href="https://vlanguage.cn/category/vyuyan">V语言</a> (14)
</li>
	<li class="cat-item cat-item-46"><a href="https://vlanguage.cn/category/jieshaolei">介绍类</a> (1)
</li>
	<li class="cat-item cat-item-47"><a href="https://vlanguage.cn/category/qukuailian">区块链</a> (1)
</li>
	<li class="cat-item cat-item-48"><a href="https://vlanguage.cn/category/botuv14">博途V14</a> (1)
</li>
	<li class="cat-item cat-item-29"><a href="https://vlanguage.cn/category/yuanchuangxiaoruanjian">原创小软件</a> (1)
</li>
	<li class="cat-item cat-item-15"><a href="https://vlanguage.cn/category/kaifa">开发</a> (1)
</li>
	<li class="cat-item cat-item-18"><a href="https://vlanguage.cn/category/ganwuzongjie">感悟总结</a> (1)
</li>
	<li class="cat-item cat-item-3"><a href="https://vlanguage.cn/category/wendangbiji">文档笔记</a> (1)
</li>
	<li class="cat-item cat-item-26"><a href="https://vlanguage.cn/category/jiqirenfangzhenv-rep">机器人仿真V-REP</a> (1)
</li>
	<li class="cat-item cat-item-17"><a href="https://vlanguage.cn/category/shenghuoleyuan">生活乐园</a> (1)
</li>
	<li class="cat-item cat-item-4"><a href="https://vlanguage.cn/category/biancheng">编程</a> (1)
</li>
		</ul>
			</aside></div><div class="widget-wrap"><aside id="archives-2" class="widget widget_archive clearfix"><div class="widget-header"><h3 class="widget-title">文章归档</h3></div>		<ul>
				<li><a href="https://vlanguage.cn/article/date/2019/11">2019年十一月</a> (2)</li>
	<li><a href="https://vlanguage.cn/article/date/2019/09">2019年九月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2019/08">2019年八月</a> (2)</li>
	<li><a href="https://vlanguage.cn/article/date/2019/07">2019年七月</a> (12)</li>
	<li><a href="https://vlanguage.cn/article/date/2019/06">2019年六月</a> (13)</li>
	<li><a href="https://vlanguage.cn/article/date/2019/05">2019年五月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2019/03">2019年三月</a> (3)</li>
	<li><a href="https://vlanguage.cn/article/date/2019/02">2019年二月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2018/11">2018年十一月</a> (2)</li>
	<li><a href="https://vlanguage.cn/article/date/2018/03">2018年三月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2018/02">2018年二月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2017/10">2017年十月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2017/07">2017年七月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2016/09">2016年九月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2016/04">2016年四月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2016/02">2016年二月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2015/12">2015年十二月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2015/04">2015年四月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2012/07">2012年七月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2012/03">2012年三月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2010/11">2010年十一月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2010/02">2010年二月</a> (1)</li>
	<li><a href="https://vlanguage.cn/article/date/2007/07">2007年七月</a> (2)</li>
	<li><a href="https://vlanguage.cn/article/date/2005/12">2005年十二月</a> (1)</li>
		</ul>
			</aside></div><div class="widget_text widget-wrap"><aside id="custom_html-7" class="widget_text widget widget_custom_html clearfix"><div class="textwidget custom-html-widget"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8889449066804352" data-ad-slot="6054387901" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></aside></div>
	</section>

	

	</div>

	
	<div id="footer" class="footer-wrap">

		<footer id="colophon" class="site-footer container clearfix" role="contentinfo">

			
			<div id="footer-text" class="site-info">
				
	<span class="credit-link">
		Copyright ©️V语言中文社区	</span>

				</div>

		</footer>

	</div>

</div>


</body>
</html>
